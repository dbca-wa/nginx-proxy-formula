# nginx template generated by Salt, don't bother editing
{% for name, server in pillar['nginx-servers'].iteritems() %}
server {
    server_name     {{ name }};
    {% if 'nginx-ssl' in pillar and name in pillar['nginx-ssl'] %}
    ssl_certificate     {{ pillar['nginx-ssl'][name] }}.crt;
    ssl_certificate_key {{ pillar['nginx-ssl'][name] }}.key;{% endif %}
    {% for extra in server.get('extra', []) %}
    {{ extra }};{% endfor %}
    {% for include in server.get('includes', []) %}
    include         {{ include }};{% endfor %} 
    {% for address in server.get('allow', []) %}
    allow           {{ address }};{% endfor %}
    {% for l in server.get('locations', []) %}
    location {{ l['path'] }} { {% for rule in l['rules'] %}
        {{ rule }}{% if rule[-1] not in [';', '}'] %};{% endif %}{% endfor %}
    }
    {% endfor %}
}
{% endfor %}
